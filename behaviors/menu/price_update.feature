# language: zh-CN

功能: 菜单价格批量更新
  作为 星巴克运营人员
  我想要 批量更新特定区域的饮品价格
  以便 快速响应市场变化和成本波动

  背景:
    假如 系统中存在以下区域配置:
      | 区域   | 门店数量 |
      | 华东区 | 150     |
      | 华北区 | 120     |
      | 华南区 | 80      |
    并且 当前"大杯拿铁"的基准价格为36元

  场景: 单一区域价格上调
    假如 运营人员登录价格管理系统
    当 提交以下价格调整请求:
      | 产品名称  | 规格 | 目标区域 | 调整类型 | 调整金额 | 生效日期   |
      | 大杯拿铁  | 大杯 | 华东区   | 上调     | 2元      | 2026-02-10 |
    那么 系统应生成价格变更单 "PCO-20260204-001"
    并且 变更单状态为 "待审批"
    并且 变更单应包含 150 个门店

  场景: 价格变更审批通过后自动生效
    假如 存在待审批的价格变更单 "PCO-20260204-001"
    当 审批人通过该变更单
    并且 系统时间到达 "2026-02-10 00:00:00"
    那么 华东区所有门店的"大杯拿铁"价格应更新为 38元
    并且 价格历史记录应保存以下信息:
      | 字段       | 值                    |
      | 产品编码   | LATTE-GRANDE         |
      | 原价格     | 36.00                |
      | 新价格     | 38.00                |
      | 生效时间   | 2026-02-10 00:00:00  |
      | 变更原因   | 市场调整              |
    并且 应发送价格变更通知给所有华东区门店

  场景: 多区域差异化定价
    假如 运营人员需要针对不同区域设置差异化价格
    当 提交以下批量价格调整:
      | 产品名称      | 华东区价格 | 华北区价格 | 华南区价格 |
      | 大杯拿铁      | 38元       | 36元       | 37元       |
      | 大杯美式      | 32元       | 30元       | 31元       |
      | 大杯摩卡      | 42元       | 40元       | 41元       |
    那么 系统应生成 3 个独立的价格变更单
    并且 每个变更单应关联正确的区域门店
    并且 总计应影响 350 个门店

  场景: 价格调整异常回滚
    假如 价格变更单 "PCO-20260204-001" 已审批通过
    并且 变更已开始执行
    当 执行过程中第50个门店更新失败
    那么 系统应自动回滚所有已更新的门店价格
    并且 变更单状态应更新为 "执行失败"
    并且 应记录失败原因 "门店价格同步失败"
    并且 应通知运营人员和技术支持团队

  场景: 价格变更历史查询
    假如 系统中存在以下历史价格记录:
      | 产品     | 区域   | 变更时间       | 原价格 | 新价格 |
      | 大杯拿铁 | 华东区 | 2026-01-15    | 35元   | 36元   |
      | 大杯拿铁 | 华东区 | 2026-02-10    | 36元   | 38元   |
    当 查询"大杯拿铁"在"华东区"的价格历史
    那么 应返回 2 条历史记录
    并且 记录应按时间倒序排列
    并且 应显示每次变更的审批人和变更原因

  场景大纲: 价格调整金额验证
    假如 运营人员尝试调整产品价格
    当 提交的调整金额为 <调整金额>
    那么 系统应 <验证结果>

    例子:
      | 调整金额 | 验证结果                           |
      | 0.5元    | 通过验证                           |
      | 15元     | 拒绝并提示"单次调整金额不能超过10元" |
      | -20元    | 拒绝并提示"价格下调不能超过原价30%"  |
      | 2元      | 通过验证                           |
