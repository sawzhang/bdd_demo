#!/bin/bash

# BDD æµ‹è¯•æ‰§è¡Œæ¼”ç¤ºè„šæœ¬
# ç”¨äºæ¼”ç¤ºå¦‚ä½•è¿è¡Œ Cucumber BDD æµ‹è¯•

set -e

echo "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”"
echo "ğŸ§ª BDD æµ‹è¯•æ‰§è¡Œæ¼”ç¤º"
echo "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”"
echo ""

# 1. æ£€æŸ¥ç¯å¢ƒ
echo "ğŸ“‹ æ­¥éª¤ 1: æ£€æŸ¥ç¯å¢ƒ"
echo "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”"

if command -v java &> /dev/null; then
    echo "âœ“ Java å·²å®‰è£…: $(java -version 2>&1 | head -n 1)"
else
    echo "âœ— Java æœªå®‰è£…ï¼Œè¯·å…ˆå®‰è£… Java 17+"
    exit 1
fi

if command -v mvn &> /dev/null; then
    echo "âœ“ Maven å·²å®‰è£…: $(mvn -version | head -n 1)"
else
    echo "âœ— Maven æœªå®‰è£…ï¼Œè¯·å…ˆå®‰è£… Maven 3.8+"
    exit 1
fi

echo ""

# 2. æŸ¥çœ‹ BDD åœºæ™¯
echo "ğŸ“‹ æ­¥éª¤ 2: æŸ¥çœ‹ BDD åœºæ™¯"
echo "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”"
echo "BDD åœºæ™¯æ–‡ä»¶: behaviors/menu/price_update.feature"
echo ""
echo "åœºæ™¯æ¦‚è§ˆ:"
grep "^  åœºæ™¯:" behaviors/menu/price_update.feature | head -6
echo ""
echo "å…± $(grep -c '^  åœºæ™¯:' behaviors/menu/price_update.feature) ä¸ªåœºæ™¯"
echo ""

# 3. æŸ¥çœ‹æµ‹è¯•æ­¥éª¤å®šä¹‰
echo "ğŸ“‹ æ­¥éª¤ 3: æŸ¥çœ‹æµ‹è¯•æ­¥éª¤å®šä¹‰"
echo "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”"
echo "æµ‹è¯•æ­¥éª¤æ–‡ä»¶: src/test/bdd/PriceUpdateSteps.java"
echo ""
echo "æ”¯æŒçš„ä¸­æ–‡å…³é”®è¯:"
echo "  âœ“ @å‡å¦‚ (Given)"
echo "  âœ“ @å½“ (When)"
echo "  âœ“ @é‚£ä¹ˆ (Then)"
echo "  âœ“ @å¹¶ä¸” (And)"
echo ""

# 4. ç¼–è¯‘é¡¹ç›®
echo "ğŸ“‹ æ­¥éª¤ 4: ç¼–è¯‘é¡¹ç›® (æ¨¡æ‹Ÿ)"
echo "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”"
echo "$ mvn clean compile"
echo ""
echo "æ³¨æ„: è¿™æ˜¯ä¸€ä¸ªæ¼”ç¤ºé¡¹ç›®ï¼Œå®é™…éœ€è¦å®Œæ•´çš„ Spring Boot åº”ç”¨é…ç½®æ‰èƒ½ç¼–è¯‘"
echo ""

# 5. è¿è¡Œ BDD æµ‹è¯• (æ¨¡æ‹Ÿ)
echo "ğŸ“‹ æ­¥éª¤ 5: è¿è¡Œ BDD æµ‹è¯• (æ¨¡æ‹Ÿ)"
echo "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”"
echo "$ mvn test -Dtest=BddTestRunner"
echo ""
echo "æ¨¡æ‹Ÿæµ‹è¯•æ‰§è¡Œè¾“å‡º:"
echo ""

cat << 'EOF'
[INFO] -------------------------------------------------------
[INFO]  T E S T S
[INFO] -------------------------------------------------------
[INFO] Running com.starbucks.menu.test.bdd.BddTestRunner

åŠŸèƒ½: èœå•ä»·æ ¼æ‰¹é‡æ›´æ–°

  èƒŒæ™¯:                                                      # behaviors/menu/price_update.feature:8
    å‡å¦‚ ç³»ç»Ÿä¸­å­˜åœ¨ä»¥ä¸‹åŒºåŸŸé…ç½®:                              # PriceUpdateSteps.ç³»ç»Ÿä¸­å­˜åœ¨ä»¥ä¸‹åŒºåŸŸé…ç½®(DataTable)
      | åŒºåŸŸ   | é—¨åº—æ•°é‡ |
      | åä¸œåŒº | 150     |
      | ååŒ—åŒº | 120     |
      | åå—åŒº | 80      |
    å¹¶ä¸” å½“å‰"å¤§æ¯æ‹¿é“"çš„åŸºå‡†ä»·æ ¼ä¸º36å…ƒ                       # PriceUpdateSteps.å½“å‰äº§å“çš„åŸºå‡†ä»·æ ¼ä¸ºå…ƒ(String,int)

  åœºæ™¯: å•ä¸€åŒºåŸŸä»·æ ¼ä¸Šè°ƒ                                     # behaviors/menu/price_update.feature:16
    å‡å¦‚ è¿è¥äººå‘˜ç™»å½•ä»·æ ¼ç®¡ç†ç³»ç»Ÿ                             # PriceUpdateSteps.è¿è¥äººå‘˜ç™»å½•ä»·æ ¼ç®¡ç†ç³»ç»Ÿ()
    å½“ æäº¤ä»¥ä¸‹ä»·æ ¼è°ƒæ•´è¯·æ±‚:                                 # PriceUpdateSteps.æäº¤ä»¥ä¸‹ä»·æ ¼è°ƒæ•´è¯·æ±‚(DataTable)
      | äº§å“åç§° | è§„æ ¼ | ç›®æ ‡åŒºåŸŸ | è°ƒæ•´ç±»å‹ | è°ƒæ•´é‡‘é¢ | ç”Ÿæ•ˆæ—¥æœŸ   |
      | å¤§æ¯æ‹¿é“ | å¤§æ¯ | åä¸œåŒº   | ä¸Šè°ƒ     | 2å…ƒ      | 2026-02-10 |
    é‚£ä¹ˆ ç³»ç»Ÿåº”ç”Ÿæˆä»·æ ¼å˜æ›´å• "PCO-20260204-001"              # PriceUpdateSteps.ç³»ç»Ÿåº”ç”Ÿæˆä»·æ ¼å˜æ›´å•(String)
    å¹¶ä¸” å˜æ›´å•çŠ¶æ€ä¸º "å¾…å®¡æ‰¹"                               # PriceUpdateSteps.å˜æ›´å•çŠ¶æ€ä¸º(String)
    å¹¶ä¸” å˜æ›´å•åº”åŒ…å« 150 ä¸ªé—¨åº—                             # PriceUpdateSteps.å˜æ›´å•åº”åŒ…å«ä¸ªé—¨åº—(int)

  åœºæ™¯: ä»·æ ¼å˜æ›´å®¡æ‰¹é€šè¿‡åè‡ªåŠ¨ç”Ÿæ•ˆ                            # behaviors/menu/price_update.feature:25
    å‡å¦‚ å­˜åœ¨å¾…å®¡æ‰¹çš„ä»·æ ¼å˜æ›´å• "PCO-20260204-001"           # PriceUpdateSteps.å­˜åœ¨å¾…å®¡æ‰¹çš„ä»·æ ¼å˜æ›´å•(String)
    å½“ å®¡æ‰¹äººé€šè¿‡è¯¥å˜æ›´å•                                     # PriceUpdateSteps.å®¡æ‰¹äººé€šè¿‡è¯¥å˜æ›´å•()
    å¹¶ä¸” ç³»ç»Ÿæ—¶é—´åˆ°è¾¾ "2026-02-10 00:00:00"                  # PriceUpdateSteps.ç³»ç»Ÿæ—¶é—´åˆ°è¾¾(String)
    é‚£ä¹ˆ åä¸œåŒºæ‰€æœ‰é—¨åº—çš„"å¤§æ¯æ‹¿é“"ä»·æ ¼åº”æ›´æ–°ä¸º 38å…ƒ          # PriceUpdateSteps.åŒºåŸŸæ‰€æœ‰é—¨åº—çš„äº§å“ä»·æ ¼åº”æ›´æ–°ä¸ºå…ƒ(String,int)
    å¹¶ä¸” ä»·æ ¼å†å²è®°å½•åº”ä¿å­˜ä»¥ä¸‹ä¿¡æ¯:                          # PriceUpdateSteps.ä»·æ ¼å†å²è®°å½•åº”ä¿å­˜ä»¥ä¸‹ä¿¡æ¯(DataTable)
      | å­—æ®µ     | å€¼                  |
      | äº§å“ç¼–ç  | LATTE-GRANDE        |
      | åŸä»·æ ¼   | 36.00               |
      | æ–°ä»·æ ¼   | 38.00               |
      | ç”Ÿæ•ˆæ—¶é—´ | 2026-02-10 00:00:00 |
      | å˜æ›´åŸå›  | å¸‚åœºè°ƒæ•´             |
    å¹¶ä¸” åº”å‘é€ä»·æ ¼å˜æ›´é€šçŸ¥ç»™æ‰€æœ‰åä¸œåŒºé—¨åº—                    # PriceUpdateSteps.åº”å‘é€ä»·æ ¼å˜æ›´é€šçŸ¥ç»™æ‰€æœ‰åä¸œåŒºé—¨åº—()

  åœºæ™¯: å¤šåŒºåŸŸå·®å¼‚åŒ–å®šä»·                                     # behaviors/menu/price_update.feature:39
    å‡å¦‚ è¿è¥äººå‘˜éœ€è¦é’ˆå¯¹ä¸åŒåŒºåŸŸè®¾ç½®å·®å¼‚åŒ–ä»·æ ¼                # PriceUpdateSteps.è¿è¥äººå‘˜éœ€è¦é’ˆå¯¹ä¸åŒåŒºåŸŸè®¾ç½®å·®å¼‚åŒ–ä»·æ ¼()
    å½“ æäº¤ä»¥ä¸‹æ‰¹é‡ä»·æ ¼è°ƒæ•´:                                 # PriceUpdateSteps.æäº¤ä»¥ä¸‹æ‰¹é‡ä»·æ ¼è°ƒæ•´(DataTable)
      | äº§å“åç§° | åä¸œåŒºä»·æ ¼ | ååŒ—åŒºä»·æ ¼ | åå—åŒºä»·æ ¼ |
      | å¤§æ¯æ‹¿é“ | 38å…ƒ       | 36å…ƒ       | 37å…ƒ       |
      | å¤§æ¯ç¾å¼ | 32å…ƒ       | 30å…ƒ       | 31å…ƒ       |
      | å¤§æ¯æ‘©å¡ | 42å…ƒ       | 40å…ƒ       | 41å…ƒ       |
    é‚£ä¹ˆ ç³»ç»Ÿåº”ç”Ÿæˆ 3 ä¸ªç‹¬ç«‹çš„ä»·æ ¼å˜æ›´å•                       # PriceUpdateSteps.ç³»ç»Ÿåº”ç”Ÿæˆä¸ªç‹¬ç«‹çš„ä»·æ ¼å˜æ›´å•(int)
    å¹¶ä¸” æ¯ä¸ªå˜æ›´å•åº”å…³è”æ­£ç¡®çš„åŒºåŸŸé—¨åº—                        # PriceUpdateSteps.æ¯ä¸ªå˜æ›´å•åº”å…³è”æ­£ç¡®çš„åŒºåŸŸé—¨åº—()
    å¹¶ä¸” æ€»è®¡åº”å½±å“ 350 ä¸ªé—¨åº—                               # PriceUpdateSteps.æ€»è®¡åº”å½±å“ä¸ªé—¨åº—(int)

  åœºæ™¯: ä»·æ ¼è°ƒæ•´å¼‚å¸¸å›æ»š                                     # behaviors/menu/price_update.feature:50
    å‡å¦‚ ä»·æ ¼å˜æ›´å• "PCO-20260204-001" å·²å®¡æ‰¹é€šè¿‡            # PriceUpdateSteps.ä»·æ ¼å˜æ›´å•å·²å®¡æ‰¹é€šè¿‡(String)
    å¹¶ä¸” å˜æ›´å·²å¼€å§‹æ‰§è¡Œ                                      # PriceUpdateSteps.å˜æ›´å·²å¼€å§‹æ‰§è¡Œ()
    å½“ æ‰§è¡Œè¿‡ç¨‹ä¸­ç¬¬50ä¸ªé—¨åº—æ›´æ–°å¤±è´¥                          # PriceUpdateSteps.æ‰§è¡Œè¿‡ç¨‹ä¸­ç¬¬ä¸ªé—¨åº—æ›´æ–°å¤±è´¥(int)
    é‚£ä¹ˆ ç³»ç»Ÿåº”è‡ªåŠ¨å›æ»šæ‰€æœ‰å·²æ›´æ–°çš„é—¨åº—ä»·æ ¼                    # PriceUpdateSteps.ç³»ç»Ÿåº”è‡ªåŠ¨å›æ»šæ‰€æœ‰å·²æ›´æ–°çš„é—¨åº—ä»·æ ¼()
    å¹¶ä¸” å˜æ›´å•çŠ¶æ€åº”æ›´æ–°ä¸º "æ‰§è¡Œå¤±è´¥"                        # PriceUpdateSteps.å˜æ›´å•çŠ¶æ€åº”æ›´æ–°ä¸º(String)
    å¹¶ä¸” åº”è®°å½•å¤±è´¥åŸå›  "é—¨åº—ä»·æ ¼åŒæ­¥å¤±è´¥"                    # PriceUpdateSteps.åº”è®°å½•å¤±è´¥åŸå› (String)
    å¹¶ä¸” åº”é€šçŸ¥è¿è¥äººå‘˜å’ŒæŠ€æœ¯æ”¯æŒå›¢é˜Ÿ                         # PriceUpdateSteps.åº”é€šçŸ¥è¿è¥äººå‘˜å’ŒæŠ€æœ¯æ”¯æŒå›¢é˜Ÿ()

  åœºæ™¯: ä»·æ ¼å˜æ›´å†å²æŸ¥è¯¢                                     # behaviors/menu/price_update.feature:59
    å‡å¦‚ ç³»ç»Ÿä¸­å­˜åœ¨ä»¥ä¸‹å†å²ä»·æ ¼è®°å½•:                          # PriceUpdateSteps.ç³»ç»Ÿä¸­å­˜åœ¨ä»¥ä¸‹å†å²ä»·æ ¼è®°å½•(DataTable)
      | äº§å“     | åŒºåŸŸ   | å˜æ›´æ—¶é—´   | åŸä»·æ ¼ | æ–°ä»·æ ¼ |
      | å¤§æ¯æ‹¿é“ | åä¸œåŒº | 2026-01-15 | 35å…ƒ   | 36å…ƒ   |
      | å¤§æ¯æ‹¿é“ | åä¸œåŒº | 2026-02-10 | 36å…ƒ   | 38å…ƒ   |
    å½“ æŸ¥è¯¢"å¤§æ¯æ‹¿é“"åœ¨"åä¸œåŒº"çš„ä»·æ ¼å†å²                     # PriceUpdateSteps.æŸ¥è¯¢äº§å“åœ¨åŒºåŸŸçš„ä»·æ ¼å†å²(String,String)
    é‚£ä¹ˆ åº”è¿”å› 2 æ¡å†å²è®°å½•                                  # PriceUpdateSteps.åº”è¿”å›æ¡å†å²è®°å½•(int)
    å¹¶ä¸” è®°å½•åº”æŒ‰æ—¶é—´å€’åºæ’åˆ—                                 # PriceUpdateSteps.è®°å½•åº”æŒ‰æ—¶é—´å€’åºæ’åˆ—()
    å¹¶ä¸” åº”æ˜¾ç¤ºæ¯æ¬¡å˜æ›´çš„å®¡æ‰¹äººå’Œå˜æ›´åŸå›                       # PriceUpdateSteps.åº”æ˜¾ç¤ºæ¯æ¬¡å˜æ›´çš„å®¡æ‰¹äººå’Œå˜æ›´åŸå› ()

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
æµ‹è¯•ç»“æœæ±‡æ€»
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

6 Scenarios (6 passed)
25 Steps (25 passed)
0m2.347s

[INFO]
[INFO] Results:
[INFO]
[INFO] Tests run: 6, Failures: 0, Errors: 0, Skipped: 0
[INFO]
[INFO] ------------------------------------------------------------------------
[INFO] BUILD SUCCESS
[INFO] ------------------------------------------------------------------------
[INFO] Total time:  3.456 s
[INFO] Finished at: 2026-02-04T10:30:45+08:00
[INFO] ------------------------------------------------------------------------
EOF

echo ""
echo ""

# 6. æŸ¥çœ‹æµ‹è¯•æŠ¥å‘Š
echo "ğŸ“‹ æ­¥éª¤ 6: æŸ¥çœ‹æµ‹è¯•æŠ¥å‘Š"
echo "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”"
echo ""
echo "æµ‹è¯•æŠ¥å‘Šä½ç½®:"
echo "  âœ“ HTML æŠ¥å‘Š: target/cucumber-reports/cucumber.html"
echo "  âœ“ JSON æŠ¥å‘Š: target/cucumber-reports/cucumber.json"
echo "  âœ“ XML æŠ¥å‘Š:  target/cucumber-reports/cucumber.xml"
echo ""
echo "æ‰“å¼€ HTML æŠ¥å‘Š:"
echo "  $ open target/cucumber-reports/cucumber.html"
echo ""

# 7. æµ‹è¯•ç»Ÿè®¡
echo "ğŸ“‹ æ­¥éª¤ 7: æµ‹è¯•ç»Ÿè®¡"
echo "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”"
echo ""
echo "âœ… åœºæ™¯æ€»æ•°: 6"
echo "âœ… æ­¥éª¤æ€»æ•°: 25"
echo "âœ… é€šè¿‡ç‡: 100%"
echo "âœ… æ‰§è¡Œæ—¶é—´: 2.347 ç§’"
echo "âœ… è¦†ç›–ç‡: 85%"
echo ""

# 8. æ€»ç»“
echo "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”"
echo "âœ¨ BDD æµ‹è¯•æ‰§è¡Œå®Œæˆ"
echo "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”"
echo ""
echo "ğŸ“Š æ ¸å¿ƒä»·å€¼:"
echo "  âœ… æ‰€æœ‰ä¸šåŠ¡åœºæ™¯ 100% é€šè¿‡"
echo "  âœ… ä¸­æ–‡åœºæ™¯æè¿°æ¸…æ™°æ˜“æ‡‚"
echo "  âœ… æµ‹è¯•å³æ–‡æ¡£ï¼Œæ°¸ä¸è¿‡æ—¶"
echo "  âœ… å¤±è´¥å®šä½ç²¾å‡†åˆ°å…·ä½“æ­¥éª¤"
echo ""
echo "ğŸš€ ä¸‹ä¸€æ­¥:"
echo "  1. è¿è¡Œ API æµ‹è¯•: mvn test -Dkarate.options=\"--tags @pricing\""
echo "  2. æŸ¥çœ‹æµ‹è¯•è¦†ç›–ç‡: mvn jacoco:report"
echo "  3. ç”Ÿæˆå®Œæ•´æŠ¥å‘Š: mvn site"
echo ""
echo "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”"
